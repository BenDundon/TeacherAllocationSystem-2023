<!DOCTYPE html>
<html>
  @!component('components.head', title="Dashboard")
  <body>
    <div class="wrapper">
      @include('partials/sidebar')
      <div class="content-section">
        <div>
          <p id="allocationFulfillment" style="display: none;">{{allocationFulfillment}}</p>
          <p id="allocationChartType" style="display: none;">{{allocationChartType}}</p>
          <canvas id="allocationFulfillmentBarChart"></canvas>
        </div>
        <div>
          <p id="topAndBottom5Allocations" style="display: none;">{{topAndBottom5Allocations}}</p>
          <canvas id="topAndBottom5AllocationsBarChart"></canvas>
        </div>
      </div>
    </div>
  </body>
</html>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Retrieve the data passed by DashboardController, and split it back into an array
  const allocationFulfillment = document.getElementById('allocationFulfillment').innerText.split(",") ;
  const allocationChartType = document.getElementById('allocationChartType').innerText;
  // Plot the bar chart to display the fulfillment of each allocation
  const fulfillmentLabels = ['underallocated', 'well-allocated', 'overallocated']
  console.log(allocationFulfillment);
  console.log(allocationChartType);
  const allocationFulfillmentBarChart = document.getElementById('allocationFulfillmentBarChart');
  new Chart(allocationFulfillmentBarChart, {
    type: allocationChartType,
    data: {
      labels: fulfillmentLabels,
      datasets: [{
        data: allocationFulfillment,
        borderWidth: 1
      }]
    },
    options: {
      elements: {
        bar: {
          borderWidth: 2,
        }
      },
      responsive: true,
      plugins: {
        legend: {
          display: false,
          position: 'right',
        },
        title: {
          display: true,
          text: 'Allocation Summary'
        }
      }
    },
  });
</script>
<script>
  // Read JSON string data in the div tag where its id is "topAndBottom5AllocationsData"
  const topAndBottom5Allocations = document.getElementById('topAndBottom5Allocations');
  const topAndBottom5AllocationsJson = JSON.parse(topAndBottom5Allocations.innerText);

  // Store each data into labels and data arrays
  const topAndBottom5AllocationsLabels = [];
  const topAndBottom5AllocationsData = [];
  for (let key in topAndBottom5AllocationsJson) {
    const label = topAndBottom5AllocationsJson[key].unitCode + " " + topAndBottom5AllocationsJson[key].semester;
    topAndBottom5AllocationsLabels.push(label);
    topAndBottom5AllocationsData.push(
      topAndBottom5AllocationsJson[key].totalAllocatedFraction
    );
  }
  // Plot the bar chart to display Top and Bottom 5 Allocations
  const topAndBottom5AllocationsBarChart = document.getElementById('topAndBottom5AllocationsBarChart');
  new Chart(topAndBottom5AllocationsBarChart, {
    type: 'bar',
    data: {
      labels: topAndBottom5AllocationsLabels,
      datasets: [{
        label: 'Total Allocated Fraction',
        data: topAndBottom5AllocationsData,
        borderWidth: 1
      }]
    },
    options: {
      indexAxis: 'y',
      elements: {
        bar: {
          borderWidth: 2,
        }
      },
      responsive: true,
      plugins: {
        legend: {
          position: 'right',
        },
        title: {
          display: true,
          text: 'Top and Bottom 5 Allocations'
        }
      }
    },
  });
</script>

